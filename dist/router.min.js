!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("backbone"),require("lodash"));else if("function"==typeof define&&define.amd)define(["backbone","lodash"],t);else{var r="object"==typeof exports?t(require("backbone"),require("lodash")):t(e.backbone,e.lodash);for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(this,function(e,t){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e,t,r){for(var n=!0;n;){var o=e,u=t,a=r;n=!1,null===o&&(o=Function.prototype);var i=Object.getOwnPropertyDescriptor(o,u);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(a)}var s=Object.getPrototypeOf(o);if(null===s)return;e=s,t=u,r=a,n=!0,i=s=void 0}},l=r(1),s=n(l),c=r(2),f=n(c),d=r(3),h=r(4),p=r(5),v=r(6),y=r(7),_=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),e.routes&&(this.routes=e.routes),this.use(v.routeParamsFactory),this.use(y.reverseFactory)}return u(t,e),a(t,[{key:"start",value:function(e){return this._bindRoutes().then(function(){s["default"].history.start(e)})}},{key:"stop",value:function(){s["default"].history.stop()}},{key:"_bindRoutes",value:function(){if(!this.routes)return Promise.resolve();this.routes=f["default"].result(this,"routes");for(var e=null,t=[],r=f["default"].keys(this.routes);null!=(e=r.pop());)t.push(this._bindRoute(e,this.routes[e]));return Promise.all(t)}},{key:"_bindRoute",value:function(e,t){var r=this,n={route:e,name:t};return this._addRouteEvent(n,t),this.run(d.REGISTERED_LABEL,f["default"].extend(n,{label:d.REGISTERED_LABEL})).then(function(n){return r._onRegisteredDone(n),r.route(e,t,function(e){for(var t=arguments.length,o=Array(t>1?t-1:0),u=1;t>u;u++)o[u-1]=arguments[u];return r._onRouteMatched(f["default"].extend(n,{label:d.MATCHED_LABEL,fragment:e,args:o.slice(0,-1)}))})})["catch"](this._onErrorCatch.bind(this,n))}},{key:"_extractParameters",value:function(e,r){return[r].concat(i(Object.getPrototypeOf(t.prototype),"_extractParameters",this).call(this,e,r))}},{key:"_onRegisteredDone",value:function(e){return this.trigger("route:registered",e),e}},{key:"_onMatchedDone",value:function(e){return this.trigger("route:matched",e),e}},{key:"_onRouteMatched",value:function(e){var t=this;return(0,h.debounce)(function(){return t.run(d.MATCHED_LABEL,e).then(t._onMatchedDone.bind(t,e))["catch"](t._onErrorCatch.bind(t,e))})}},{key:"_onErrorCatch",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];return this.run.apply(this,[d.ERROR_LABEL,f["default"].extend(e,{label:d.ERROR_LABEL})].concat(r))}},{key:"_addRouteEvent",value:function(e,t){this._routeEvents||(this._routeEvents={}),this._routeEvents[t]=e}},{key:"getMiddleware",value:function(){return this.middleware||(this.middleware=(0,p.middleware)(this)),this.middleware}},{key:"use",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];var o=this.getMiddleware(),u=e.call.apply(e,[this].concat(r));return o(u)}},{key:"run",value:function(){var e=this.getMiddleware();return e.run.apply(e,arguments)}}]),t}(s["default"].Router);t.Router=_,t.MATCHED_LABEL=d.MATCHED_LABEL,t.REGISTERED_LABEL=d.REGISTERED_LABEL,t.ERROR_LABEL=d.ERROR_LABEL},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="matched",n="registered",o="error";t.MATCHED_LABEL=r,t.REGISTERED_LABEL=n,t.ERROR_LABEL=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];return i?(l=e,new Promise(function(t,n){var o=function(){l===e&&(i=l.apply(void 0,r),i.then(a["default"].compose(t,s),a["default"].compose(n,s)))};i?i.then(o,o):o()})):(i=e.apply(void 0,r),i.then(s,s),i)}Object.defineProperty(t,"__esModule",{value:!0});var u=r(2),a=n(u),i=null,l=null,s=function(e){return i=null,e};t.debounce=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return function(){var t=[],r=function n(r){for(var o=!0,u=arguments.length,i=Array(u>1?u-1:0),l=1;u>l;l++)i[l-1]=arguments[l];for((a["default"].isFunction(r)||a["default"].isArray(r))&&(i.unshift(r),o=!1);i.length;){var s=i.shift();if(a["default"].isArray(s))s.forEach(function(e){e.label?n(e.label,e.handler):n(e.handler?e.handler:e)});else{if(!a["default"].isFunction(s))throw new TypeError;o&&(s._label=r),t.push(s)}}return e};return r.run=function(r){for(var n=arguments.length,o=Array(n>1?n-1:0),u=1;n>u;u++)o[u-1]=arguments[u];var i=t.concat(),l=!0,s=function f(e){if(!i.length)return e.resolve.apply(e,o);var t=i.shift();l&&t._label?t._label===r?c(t,e):f(e):c(t,e)},c=function(t,r){try{Promise.resolve(t.call.apply(t,[e].concat(o))).then(function(e){e===!1?r.resolve(!1):s(r)})["catch"](r.reject)}catch(n){r.reject(n)}};return a["default"].isString(r)||(o.unshift(r),l=!1),i.length?new Promise(function(e,t){var r={resolve:e,reject:t};s(r)}):Promise.resolve.apply(Promise,o)},r}()}Object.defineProperty(t,"__esModule",{value:!0}),t.middleware=o;var u=r(2),a=n(u)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),o=function(e){var t=e.route.match(/:[a-z]+/gi)||[];return t.map(function(e){return e.slice(1)})},u=function(e){return e.route.replace(/[\(\)]/g,"")},a=function(e,t){var r={};return e.routeParams.paramNames.forEach(function(e,n){r[e]=t[n]}),r},i=function(e){return e.routeParams={paramNames:o(e),urlTemplate:u(e)},this},l=function(e){return e.routeParams.params=a(e,e.args),this},s=function(){return[{label:n.REGISTERED_LABEL,handler:i},{label:n.MATCHED_LABEL,handler:l}]};t.routeParamsFactory=s},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),u=n(o),a=r(3),i=function(){var e=this,t=void 0,r=void 0;return this.reverse=function(t,r,n){var o=e._routeEvents[t],a=o.routeParams.urlTemplate;n=n||{},u["default"].each(r,function(e,t){o.routeParams.paramNames.indexOf(t)>-1?a=a.replace(":"+t,e):null!=e&&""!=e?n[t]=e:delete n[t]});var i=e.buildUrl(a,n);return"https:"===i.slice(0,6)?i:"/"!==i[0]?"/"+i:i},this.reverseReplace=function(n){return e.reverse(r,u["default"].extend({},t,n))},this.buildUrl=function(t,r){var n=e.buildQuery(r);return n.length?t+"?"+n:t},this.buildQuery=function(e){if(!e)return"";var t=u["default"].map(e,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)});return t.join("&")},this.parseQueryToPairs=function(e){return"?"==e[0]&&(e=e.substr(1)),0===e.length?[]:e.split("&").map(function(e){var t=e.split("="),r=decodeURIComponent(t[0]),n=decodeURIComponent(u["default"].rest(t).join("=").replace(/\+/g,"%20"));return{key:r,value:n}})},this.parseQuery=function(t){var r={};return e.parseQueryToPairs(t).forEach(function(e){var t=e.key,n=e.value;t&&("[]"===t.slice(-2)?(t=t.slice(0,-2),r[t]||(r[t]=[]),r[t].push(n)):r[t]=n)}),r},[{label:a.MATCHED_LABEL,handler:function(n){var o=n.fragment.split("?").slice(1).join("?");n.query=e.parseQuery(o),t=u["default"].extend({},n.query,n.routeParams.params),r=n.name}}]};t.reverseFactory=i}])});